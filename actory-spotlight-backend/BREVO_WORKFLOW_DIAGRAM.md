# ğŸ“Š Brevo Email Verification - Complete Workflow

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER REGISTRATION FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚
â”‚  (Register   â”‚
â”‚   Form)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ POST /api/v1/auth/register
       â”‚ { name, email, password, ... }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend: controllers/auth.js            â”‚
â”‚  exports.register()                      â”‚
â”‚                                          â”‚
â”‚  1. Validate input                       â”‚
â”‚  2. Check if email exists                â”‚
â”‚  3. Generate 6-digit OTP                 â”‚
â”‚  4. Create PendingUser (temp record)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Save to DB
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MongoDB: PendingUser Collection         â”‚
â”‚                                          â”‚
â”‚  {                                       â”‚
â”‚    email: "user@example.com",           â”‚
â”‚    name: "John Doe",                    â”‚
â”‚    password: [hashed],                  â”‚
â”‚    emailVerificationOTP: "123456",      â”‚
â”‚    emailVerificationOTPExpire: [TTL],   â”‚
â”‚    createdAt: [expires in 10 min]       â”‚
â”‚  }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Async: Send email
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  utils/emailService.js                   â”‚
â”‚  sendVerificationEmail(user, otp)        â”‚
â”‚                                          â”‚
â”‚  Flow:                                   â”‚
â”‚  1. Try REST API first â”€â”€â”               â”‚
â”‚  2. Fallback to SMTP â”€â”  â”‚               â”‚
â”‚  3. Log attempt      â”‚  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                â”‚
         â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Brevo    â”‚   â”‚ Brevo SMTP / â”‚
    â”‚  REST API  â”‚   â”‚   Gmail      â”‚
    â”‚            â”‚   â”‚              â”‚
    â”‚ FASTEST âœ… â”‚   â”‚ FALLBACK     â”‚
    â”‚ 1-2 sec    â”‚   â”‚              â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Email Gateway   â”‚
         â”‚   (Internet)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  User's Email Inbox      â”‚
         â”‚                          â”‚
         â”‚  ğŸ“§ Subject:             â”‚
         â”‚  âœ‰ï¸ Verify Your Actory  â”‚
         â”‚  Email Address           â”‚
         â”‚                          â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   Your Code:       â”‚  â”‚
         â”‚  â”‚   123456           â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                          â”‚
         â”‚  Code expires in 10 min  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ User reads email
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Frontend:              â”‚
         â”‚   Verification Screen    â”‚
         â”‚                          â”‚
         â”‚   [Input: 123456 ]       â”‚
         â”‚   [Verify Button]        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ POST /api/v1/auth/verify-email
                   â”‚ { email, otp }
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend: controllers/auth.js    â”‚
    â”‚  exports.verifyEmail()           â”‚
    â”‚                                  â”‚
    â”‚  1. Find PendingUser by OTP      â”‚
    â”‚  2. Check OTP not expired        â”‚
    â”‚  3. If match:                    â”‚
    â”‚     â”œâ”€ Create User record        â”‚
    â”‚     â”œâ”€ Delete PendingUser        â”‚
    â”‚     â””â”€ Return success            â”‚
    â”‚  4. If no match:                 â”‚
    â”‚     â””â”€ Return "Invalid OTP"      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MongoDB: User       â”‚
    â”‚  Collection          â”‚
    â”‚                      â”‚
    â”‚  {                   â”‚
    â”‚    email: "...",     â”‚
    â”‚    isEmailVerified:  â”‚
    â”‚    true,             â”‚
    â”‚    ...               â”‚
    â”‚  }                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Email verified!
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  User can now        â”‚
    â”‚  Login!              â”‚
    â”‚                      â”‚
    â”‚  POST /api/v1/auth/  â”‚
    â”‚  login               â”‚
    â”‚  { email, password } â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  JWT Token           â”‚
    â”‚  { userId, exp }     â”‚
    â”‚                      â”‚
    â”‚  Stored in Cookie    â”‚
    â”‚  or LocalStorage      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  User Logged In âœ…   â”‚
    â”‚  Access Dashboard    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Email Sending Decision Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sendEmail(options)                 â”‚
â”‚  Called from:                       â”‚
â”‚  - sendVerificationEmail()          â”‚
â”‚  - sendPasswordResetEmail()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Is BREVO_API_KEY set?   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    Yes  â”‚            â”‚  No
         â”‚            â”‚
         â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Try REST â”‚  â”‚ Use SMTP Fallbackâ”‚
    â”‚ API      â”‚  â”‚                  â”‚
    â”‚ Fast âœ…  â”‚  â”‚                  â”‚
    â”‚ 1-2 sec  â”‚  â”‚ Any of:          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚ 1. Brevo SMTP    â”‚
         â”‚        â”‚ 2. Gmail SMTP    â”‚
         â”‚        â”‚ 3. Ethereal      â”‚
         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ Success?                    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    Yes  â”‚              â”‚  No
         â”‚              â”‚
         â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return â”‚   â”‚ Log error    â”‚
    â”‚ Successâ”‚   â”‚ Try fallback â”‚
    â”‚ âœ…     â”‚   â”‚ or throw     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Environment Variables Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Environment Variables Setup                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LOCAL (.env file)
â”œâ”€â”€ BREVO_API_KEY
â”‚   â””â”€ Used by: sendEmailViaBrevo()
â”‚      Priority: PRIMARY
â”‚      Format: SG.xxxxxxxxxxxxx
â”‚
â”œâ”€â”€ BREVO_FROM_EMAIL
â”‚   â””â”€ Used by: Sender address
â”‚      Must be verified in Brevo!
â”‚
â”œâ”€â”€ BREVO_FROM_NAME
â”‚   â””â”€ Used by: Sender display name
â”‚      Default: "Actory Spotlight"
â”‚
â””â”€â”€ Alternative SMTP vars (optional)
    â”œâ”€â”€ BREVO_SMTP_HOST
    â”œâ”€â”€ BREVO_SMTP_PORT
    â”œâ”€â”€ BREVO_SMTP_USER
    â””â”€â”€ BREVO_SMTP_PASS

RENDER Dashboard (Environment tab)
â”œâ”€â”€ Same 3 required variables
â””â”€â”€ Optional: Add SMTP vars for fallback
```

---

## Data Flow: OTP Lifecycle

```
                 Generate
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  OTP: "123456"                â”‚
    â”‚  Generated: timestamp1        â”‚
    â”‚  Expires: timestamp1 + 10 min â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Store in PendingUser  â”‚
    â”‚ emailVerificationOTP  â”‚
    â”‚ emailVerificationOTP  â”‚
    â”‚ Expire: TTL(300s)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Send in Email              â”‚
    â”‚ "Your code: 123456"        â”‚
    â”‚ "Expires in 10 minutes"    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User checks email            â”‚
    â”‚ Enters OTP: "123456"         â”‚
    â”‚ Sends to verification API    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Verify:                      â”‚
    â”‚ 1. Match OTP                 â”‚
    â”‚ 2. Check expiry (not passed) â”‚
    â”‚ 3. If valid â†’ Create user    â”‚
    â”‚ 4. If invalid â†’ Reject       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ VALID âœ… â”‚  â”‚ EXPIRED âŒ    â”‚
    â”‚          â”‚  â”‚ or WRONG OTP  â”‚
    â”‚ Create   â”‚  â”‚               â”‚
    â”‚ User     â”‚  â”‚ Delete        â”‚
    â”‚ Delete   â”‚  â”‚ PendingUser   â”‚
    â”‚ Pending  â”‚  â”‚ Reject login  â”‚
    â”‚ Return   â”‚  â”‚ Ask to        â”‚
    â”‚ Success  â”‚  â”‚ resend        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: REST API (Primary)           â”‚
â”‚  â””â”€ Try: sendEmailViaBrevo()           â”‚
â”‚     â””â”€ Errors:                         â”‚
â”‚        â”œâ”€ 401: API key invalid         â”‚
â”‚        â”œâ”€ 400: Email format bad        â”‚
â”‚        â”œâ”€ 429: Rate limited            â”‚
â”‚        â””â”€ 500: Brevo server error      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€ Success? Return âœ…
             â”‚
             â””â”€ Failure? Continue...
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Layer 2: SMTP Fallback    â”‚
          â”‚  â””â”€ Try: sendEmailViaSMTP()â”‚
          â”‚     â””â”€ Priority:            â”‚
          â”‚        1. Brevo SMTP       â”‚
          â”‚        2. Gmail SMTP       â”‚
          â”‚        3. Ethereal         â”‚
          â”‚     â””â”€ Errors:             â”‚
          â”‚        â”œâ”€ Connection fail  â”‚
          â”‚        â”œâ”€ Auth fail        â”‚
          â”‚        â”œâ”€ Timeout          â”‚
          â”‚        â””â”€ Server error     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”œâ”€ Success? Return âœ…
                    â”‚
                    â””â”€ Failure? Continue...
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Layer 3: Error â”‚
                    â”‚  â””â”€ Log error   â”‚
                    â”‚  â””â”€ Throw exc.  â”‚
                    â”‚  â””â”€ Frontend    â”‚
                    â”‚     shows: "Emailâ”‚
                    â”‚     failed.     â”‚
                    â”‚     Try again"  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Success Metrics

```
âœ… Email Sent Successfully
   â””â”€ REST API < 2 seconds
   â””â”€ User receives email immediately
   â””â”€ OTP valid for 10 minutes
   â””â”€ User enters OTP
   â””â”€ Account created
   â””â”€ User can login

ğŸ“Š Monitoring
   â””â”€ Brevo Dashboard: "Logs" section
   â””â”€ Shows all sent/failed emails
   â””â”€ Delivery status per recipient
   â””â”€ Performance metrics
   â””â”€ Bounce rate tracking

ğŸ” Troubleshooting Points
   â””â”€ API key valid? Check env vars
   â””â”€ Sender verified? Check Brevo
   â””â”€ Email in spam? Check spam folder
   â””â”€ Rate limited? Check Brevo logs
   â””â”€ Server down? Check service status
```

---

**See implementation guide for detailed setup instructions!**
